!function(){"use strict";var t=class{constructor(t={}){this.config={apiEndpoint:t.apiEndpoint||"",shop:t.shop||"",productId:t.productId||null,theme:t.theme||"default",position:t.position||"below-price",animation:t.animation||"highlight",debug:t.debug||!1,autoInit:!1!==t.autoInit,autoDetectProduct:!1!==t.autoDetectProduct,showDescription:!1!==t.showDescription,showImage:t.showImage||!1,primaryColor:t.primaryColor||"#007bff",textColor:t.textColor||"#333333",borderColor:t.borderColor||"#e1e8ed",selectedBackgroundColor:t.selectedBackgroundColor||"#e7f3ff",customCss:t.customCss||"",onInit:t.onInit||null,onAddOnToggle:t.onAddOnToggle||null,onCartUpdate:t.onCartUpdate||null,onError:t.onError||null,...t},this.state={initialized:!1,addOns:[],selectedAddOns:new Set,cartItems:[],loading:!1,error:null},this.elements={container:null,widgets:[]},this.config.autoInit&&this.init()}async init(){try{if(this.log("Initializing Shoplazza Add-On Widget..."),!this.validateConfig())throw new Error("Invalid widget configuration");if(await this.waitForDOM(),this.config.autoDetectProduct&&!this.config.productId&&(this.config.productId=this.detectProductId()),!this.config.productId)throw new Error("Product ID not found. Cannot initialize widget.");await this.loadAddOnConfiguration(),this.createWidgetElements(),this.applyStyles(),this.setupEventListeners(),await this.loadCartState(),this.state.initialized=!0,this.log("Widget initialized successfully"),this.config.onInit&&this.config.onInit(this)}catch(t){this.handleError("Failed to initialize widget",t)}}validateConfig(){const t=["shop"];for(const e of t)if(!this.config[e])return this.log(`Missing required configuration: ${e}`,"error"),!1;return!0}waitForDOM(){return new Promise(t=>{"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()})}detectProductId(){const t=[()=>{const t=document.querySelector('meta[name="product-id"]');return t?t.getAttribute("content"):null},()=>window.ShoplazzaAnalytics&&window.ShoplazzaAnalytics.meta?window.ShoplazzaAnalytics.meta.product?.id:null,()=>{const t=window.location.pathname.match(/\/products\/(\d+)/);return t?t[1]:null},()=>{const t=document.querySelector('form[action*="/cart/add"]');if(t){const e=t.querySelector('input[name="id"]');return e?e.value:null}return null}];for(const e of t)try{const t=e();if(t)return this.log(`Detected product ID: ${t}`),parseInt(t,10)}catch(t){this.log(`Product detection method failed: ${t.message}`,"warn")}return this.log("Could not detect product ID","warn"),null}async loadAddOnConfiguration(){try{this.state.loading=!0;const t=await fetch(`${this.config.apiEndpoint}/api/products/${this.config.productId}?shop=${encodeURIComponent(this.config.shop)}`);if(t.ok){const e=await t.json();e.isEnabled?(this.state.addOns=[e],this.log("Add-on configuration loaded",e)):this.log("Add-on is disabled for this product")}else{if(404!==t.status)throw new Error(`API error: ${t.status}`);this.log("No add-on configuration found for this product")}}catch(t){this.handleError("Failed to load add-on configuration",t)}finally{this.state.loading=!1}}createWidgetElements(){if(0===this.state.addOns.length)return void this.log("No add-ons to display");const t=this.findInsertionPoint();if(!t)throw new Error("Could not find suitable insertion point for widget");this.elements.container=document.createElement("div"),this.elements.container.className="shoplazza-addon-container",this.elements.container.dataset.theme=this.config.theme,this.state.addOns.forEach((t,e)=>{const n=this.createAddOnWidget(t,e);this.elements.widgets.push(n),this.elements.container.appendChild(n)}),this.insertWidget(t,this.elements.container),this.log("Widget elements created and inserted")}findInsertionPoint(){const t={"above-price":[".product-price",".price",'[class*="price"]'],"below-price":[".product-price",".price",'[class*="price"]'],"above-add-to-cart":['button[type="submit"][name="add"]',".product-form__cart",".product-form__buttons",".add-to-cart"],"below-add-to-cart":['button[type="submit"][name="add"]',".product-form__cart",".product-form__buttons",".add-to-cart"]},e=t[this.config.position]||t["below-price"];for(const t of e){const e=document.querySelector(t);if(e)return{element:e,position:this.config.position}}const n=document.querySelector('form[action*="/cart/add"]');return n?{element:n,position:"below-add-to-cart"}:null}insertWidget(t,e){const{element:n,position:o}=t;switch(o){case"above-price":case"above-add-to-cart":n.parentNode.insertBefore(e,n);break;default:n.parentNode.insertBefore(e,n.nextSibling)}}createAddOnWidget(t,e){const n=document.createElement("div");n.className="shoplazza-addon-widget",n.dataset.addOnId=t.id,n.dataset.productId=t.productId;const o=this.state.selectedAddOns.has(t.id);return n.innerHTML=`\n      <div class="addon-container ${o?"selected":""}">\n        <label class="addon-label">\n          <input type="checkbox" class="addon-checkbox" ${o?"checked":""}>\n          <span class="addon-checkmark"></span>\n          <div class="addon-content">\n            <div class="addon-main">\n              <span class="addon-title">${this.escapeHtml(t.addOn.displayText)}</span>\n              <span class="addon-price">+${this.escapeHtml(t.addOn.price)}</span>\n            </div>\n            ${this.config.showDescription&&t.addOn.description?`\n              <div class="addon-description">${this.escapeHtml(t.addOn.description)}</div>\n            `:""}\n            ${this.config.showImage&&t.addOn.imageUrl?`\n              <div class="addon-image">\n                <img src="${this.escapeHtml(t.addOn.imageUrl)}" alt="${this.escapeHtml(t.addOn.title)}" loading="lazy">\n              </div>\n            `:""}\n          </div>\n        </label>\n      </div>\n    `,n}applyStyles(){if(document.getElementById("shoplazza-addon-styles"))return;const t=document.createElement("style");t.id="shoplazza-addon-styles",t.textContent=this.generateCSS(),document.head.appendChild(t),this.log("Styles applied")}generateCSS(){return`\n      .shoplazza-addon-container {\n        margin: 15px 0;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      }\n\n      .shoplazza-addon-widget {\n        margin-bottom: 10px;\n      }\n\n      .addon-container {\n        border: 1px solid ${this.config.borderColor};\n        border-radius: 6px;\n        padding: 12px;\n        transition: all 0.2s ease;\n        background: #fff;\n        cursor: pointer;\n      }\n\n      .addon-container:hover {\n        border-color: ${this.config.primaryColor};\n        box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n      }\n\n      .addon-container.selected {\n        border-color: ${this.config.primaryColor};\n        background-color: ${this.config.selectedBackgroundColor};\n      }\n\n      .addon-label {\n        display: flex;\n        align-items: flex-start;\n        cursor: pointer;\n        margin: 0;\n      }\n\n      .addon-checkbox {\n        margin: 0;\n        margin-right: 10px;\n        margin-top: 2px;\n      }\n\n      .addon-content {\n        flex: 1;\n      }\n\n      .addon-main {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 4px;\n      }\n\n      .addon-title {\n        font-weight: 500;\n        color: ${this.config.textColor};\n        font-size: 14px;\n      }\n\n      .addon-price {\n        font-weight: 600;\n        color: ${this.config.primaryColor};\n        font-size: 14px;\n      }\n\n      .addon-description {\n        color: #666;\n        font-size: 12px;\n        line-height: 1.4;\n        margin-top: 4px;\n      }\n\n      .addon-image {\n        margin-top: 8px;\n      }\n\n      .addon-image img {\n        max-width: 60px;\n        max-height: 40px;\n        border-radius: 4px;\n      }\n\n      /* Theme variations */\n      .shoplazza-addon-container[data-theme="minimal"] .addon-container {\n        border: none;\n        border-bottom: 1px solid ${this.config.borderColor};\n        border-radius: 0;\n        padding: 8px 0;\n      }\n\n      .shoplazza-addon-container[data-theme="rounded"] .addon-container {\n        border-radius: 12px;\n      }\n\n      /* Animation classes */\n      .addon-price-highlight {\n        animation: priceHighlight 0.6s ease;\n      }\n\n      @keyframes priceHighlight {\n        0%, 100% { background-color: transparent; }\n        50% { background-color: ${this.config.primaryColor}20; }\n      }\n\n      /* Custom CSS */\n      ${this.config.customCss}\n    `}setupEventListeners(){this.elements.container.addEventListener("change",t=>{t.target.classList.contains("addon-checkbox")&&this.handleAddOnToggle(t)}),this.interceptCartForms(),this.log("Event listeners set up")}async handleAddOnToggle(t){const e=t.target,n=e.closest(".shoplazza-addon-widget"),o=parseInt(n.dataset.addOnId,10),i=e.checked;try{e.closest(".addon-container").classList.toggle("selected",i),i?this.state.selectedAddOns.add(o):this.state.selectedAddOns.delete(o),"highlight"===this.config.animation&&this.animatePriceChange(),this.config.onAddOnToggle&&this.config.onAddOnToggle(o,i,this),this.log(`Add-on ${o} ${i?"selected":"deselected"}`)}catch(t){this.handleError("Failed to toggle add-on",t)}}animatePriceChange(){document.querySelectorAll(".addon-price").forEach(t=>{t.classList.remove("addon-price-highlight"),t.offsetHeight,t.classList.add("addon-price-highlight")})}interceptCartForms(){document.querySelectorAll('form[action*="/cart/add"]').forEach(t=>{t.addEventListener("submit",e=>{this.handleCartFormSubmit(e,t)})})}async handleCartFormSubmit(t,e){if(0!==this.state.selectedAddOns.size){t.preventDefault();try{const t=new FormData(e),n=t.get("id"),o=parseInt(t.get("quantity")||"1",10);await this.addToCart(n,o);for(const t of this.state.selectedAddOns){const e=this.state.addOns.find(e=>e.id===t);e&&e.addOn.addOnVariantId&&await this.addToCart(e.addOn.addOnVariantId,o,{_addon:"true",_addon_for:n,_addon_title:e.addOn.title})}this.config.onCartUpdate&&this.config.onCartUpdate(this.state.selectedAddOns,this),e.action&&e.action.includes("/cart/add")&&(window.location.href="/cart")}catch(t){this.handleError("Failed to add items to cart",t)}}}async addToCart(t,e,n={}){const o=await fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t,quantity:e,properties:n})});if(!o.ok)throw new Error(`Failed to add item to cart: ${o.status}`);return o.json()}async loadCartState(){try{const t=await fetch("/cart.js");t.ok&&(this.state.cartItems=await t.json())}catch(t){this.log("Failed to load cart state","warn")}}handleError(t,e){this.state.error=e,this.log(`${t}: ${e.message}`,"error"),this.config.onError&&this.config.onError(t,e,this)}log(t,e="info"){if(!this.config.debug)return;const n="[Shoplazza Add-On Widget]";switch(e){case"error":console.error(n,t);break;case"warn":console.warn(n,t);break;default:console.log(n,t)}}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}destroy(){this.elements.container&&this.elements.container.remove();const t=document.getElementById("shoplazza-addon-styles");t&&t.remove(),this.state.initialized=!1,this.log("Widget destroyed")}getState(){return{...this.state}}updateConfig(t){if(this.config={...this.config,...t},this.state.initialized&&["primaryColor","textColor","borderColor","selectedBackgroundColor","customCss"].some(e=>t.hasOwnProperty(e))){const t=document.getElementById("shoplazza-addon-styles");t&&(t.textContent=this.generateCSS())}}},e=class{constructor(t={}){this.config={debug:t.debug||!1,retryAttempts:t.retryAttempts||3,retryDelay:t.retryDelay||1e3,...t},this.state={cart:null,lastUpdate:null}}async getCart(){try{const t=await fetch("/cart.js",{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to get cart: ${t.status}`);return this.state.cart=await t.json(),this.state.lastUpdate=Date.now(),this.log("Cart loaded",this.state.cart),this.state.cart}catch(t){throw this.log(`Failed to get cart: ${t.message}`,"error"),t}}async addToCart(t,e=1,n={}){const o={id:t,quantity:e,properties:n};return this.makeCartRequest("/cart/add.js","POST",o)}async updateCart(t){const e={updates:t};return this.makeCartRequest("/cart/update.js","POST",e)}async changeCartLine(t,e,n={}){const o={line:t,quantity:e,properties:n};return this.makeCartRequest("/cart/change.js","POST",o)}async removeFromCart(t){const e={[t]:0};return this.updateCart(e)}async clearCart(){return this.makeCartRequest("/cart/clear.js","POST")}async addMultipleToCart(t){const e=[];for(const n of t)try{const t=await this.addToCart(n.variantId,n.quantity,n.properties);e.push({success:!0,item:n,result:t})}catch(t){this.log(`Failed to add item ${n.variantId}: ${t.message}`,"error"),e.push({success:!1,item:n,error:t})}return e}async isAddOnInCart(t,e){return(await this.getCart()).items.some(n=>n.variant_id===t&&"true"===n.properties._addon&&n.properties._addon_for===e.toString())}async getAddOnItems(){return(await this.getCart()).items.filter(t=>t.properties&&"true"===t.properties._addon)}async removeAddOnsForProduct(t){const e=await this.getCart(),n=e.items.filter(e=>e.properties&&"true"===e.properties._addon&&e.properties._addon_for===t.toString()),o={};return n.forEach(t=>{o[t.variant_id]=0}),Object.keys(o).length>0?this.updateCart(o):e}async syncAddOnsWithCart(t,e,n=1){try{const o=(await this.getCart()).items.filter(e=>e.properties&&"true"===e.properties._addon&&e.properties._addon_for===t.toString()),i={},a=[];o.forEach(t=>{const o=t.properties._addon_id;e.has(parseInt(o,10))?t.quantity!==n&&(i[t.variant_id]=n):i[t.variant_id]=0});for(const i of e.values())!o.some(t=>t.properties._addon_id===i.id.toString())&&i.addOnVariantId&&a.push({variantId:i.addOnVariantId,quantity:n,properties:{_addon:"true",_addon_for:t.toString(),_addon_id:i.id.toString(),_addon_title:i.addOn.title}});return Object.keys(i).length>0&&await this.updateCart(i),a.length>0&&await this.addMultipleToCart(a),this.getCart()}catch(t){throw this.log(`Failed to sync add-ons: ${t.message}`,"error"),t}}async getCartTotal(){const t=await this.getCart();return{totalPrice:t.total_price,itemCount:t.item_count,addOnCount:t.items.filter(t=>t.properties&&"true"===t.properties._addon).length}}async makeCartRequest(t,e,n=null,o=1){try{const o={method:e,headers:{"Content-Type":"application/json"}};!n||"POST"!==e&&"PUT"!==e||(o.body=JSON.stringify(n));const i=await fetch(t,o);if(!i.ok){const t=await i.text();throw new Error(`Cart API error ${i.status}: ${t}`)}const a=await i.json();return this.state.cart=a,this.state.lastUpdate=Date.now(),this.log(`Cart ${e} ${t}`,a),a}catch(i){if(this.log(`Cart request failed (attempt ${o}): ${i.message}`,"error"),o<this.config.retryAttempts)return await this.delay(this.config.retryDelay*o),this.makeCartRequest(t,e,n,o+1);throw i}}delay(t){return new Promise(e=>setTimeout(e,t))}onCartChange(t){const e=setInterval(async()=>{try{const e=await this.getCart();this.state.lastUpdate&&e&&t(e)}catch(t){this.log(`Error checking cart changes: ${t.message}`,"error")}},5e3);return()=>clearInterval(e)}formatPrice(t,e="USD"){const n=t/100;return new Intl.NumberFormat("en-US",{style:"currency",currency:e}).format(n)}async getAddOnSummary(){const t=(await this.getCart()).items.filter(t=>t.properties&&"true"===t.properties._addon);return{count:t.length,totalPrice:t.reduce((t,e)=>t+e.final_line_price,0),items:t.map(t=>({id:t.id,variantId:t.variant_id,title:t.properties._addon_title||t.title,price:t.final_price,quantity:t.quantity,linePrice:t.final_line_price,forProduct:t.properties._addon_for}))}}async validateCart(){const t=await this.getCart(),e=[],n=t.items.filter(t=>t.properties&&"true"===t.properties._addon),o=t.items.filter(t=>!t.properties||"true"!==t.properties._addon);return n.forEach(t=>{o.some(e=>e.variant_id.toString()===t.properties._addon_for)||e.push({type:"orphaned_addon",item:t,message:`Add-on "${t.title}" has no corresponding main product`})}),{valid:0===e.length,issues:e}}async cleanupOrphanedAddOns(){const t=await this.validateCart();if(!t.valid){const e=t.issues.filter(t=>"orphaned_addon"===t.type).map(t=>t.item);if(e.length>0){const t={};e.forEach(e=>{t[e.variant_id]=0}),await this.updateCart(t),this.log(`Cleaned up ${e.length} orphaned add-ons`)}}return this.getCart()}log(t,e="info"){if(!this.config.debug)return;const n="[Cart Service]";switch(e){case"error":console.error(n,t);break;case"warn":console.warn(n,t);break;default:console.log(n,t)}}getState(){return{...this.state}}},n=class{constructor(t={}){this.config={theme:t.theme||"default",primaryColor:t.primaryColor||"#007bff",textColor:t.textColor||"#333333",borderColor:t.borderColor||"#e1e8ed",selectedBackgroundColor:t.selectedBackgroundColor||"#e7f3ff",customCss:t.customCss||"",debug:t.debug||!1,...t},this.themes=this.initializeThemes(),this.styleElement=null}initializeThemes(){return{default:{name:"Default",styles:{container:{margin:"15px 0",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},widget:{marginBottom:"10px"},addonContainer:{border:`1px solid ${this.config.borderColor}`,borderRadius:"6px",padding:"12px",transition:"all 0.2s ease",background:"#fff",cursor:"pointer"},addonContainerHover:{borderColor:this.config.primaryColor,boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},addonContainerSelected:{borderColor:this.config.primaryColor,backgroundColor:this.config.selectedBackgroundColor}}},minimal:{name:"Minimal",styles:{container:{margin:"10px 0",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},widget:{marginBottom:"8px"},addonContainer:{border:"none",borderBottom:`1px solid ${this.config.borderColor}`,borderRadius:"0",padding:"8px 0",transition:"all 0.2s ease",background:"transparent",cursor:"pointer"},addonContainerHover:{backgroundColor:"#f8f9fa"},addonContainerSelected:{backgroundColor:this.config.selectedBackgroundColor,borderBottomColor:this.config.primaryColor}}},rounded:{name:"Rounded",styles:{container:{margin:"15px 0",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},widget:{marginBottom:"12px"},addonContainer:{border:`2px solid ${this.config.borderColor}`,borderRadius:"16px",padding:"16px",transition:"all 0.3s ease",background:"#fff",cursor:"pointer"},addonContainerHover:{borderColor:this.config.primaryColor,transform:"translateY(-1px)",boxShadow:"0 4px 8px rgba(0,0,0,0.12)"},addonContainerSelected:{borderColor:this.config.primaryColor,backgroundColor:this.config.selectedBackgroundColor,transform:"translateY(-1px)"}}},compact:{name:"Compact",styles:{container:{margin:"8px 0",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},widget:{marginBottom:"6px"},addonContainer:{border:`1px solid ${this.config.borderColor}`,borderRadius:"4px",padding:"8px",transition:"all 0.15s ease",background:"#fff",cursor:"pointer"},addonContainerHover:{borderColor:this.config.primaryColor},addonContainerSelected:{borderColor:this.config.primaryColor,backgroundColor:this.config.selectedBackgroundColor}}}}}applyTheme(){this.styleElement&&this.styleElement.remove(),this.styleElement=document.createElement("style"),this.styleElement.id="shoplazza-addon-theme-styles",this.styleElement.textContent=this.generateCSS(),document.head.appendChild(this.styleElement),this.log(`Applied theme: ${this.config.theme}`)}generateCSS(){const t=this.themes[this.config.theme]||this.themes.default;return`\n      /* Shoplazza Add-On Widget - ${t.name} Theme */\n      .shoplazza-addon-container {\n        margin: ${t.styles.container.margin};\n        font-family: ${t.styles.container.fontFamily};\n      }\n\n      .shoplazza-addon-widget {\n        margin-bottom: ${t.styles.widget.marginBottom};\n      }\n\n      .addon-container {\n        ${this.stylesToCSS(t.styles.addonContainer)}\n      }\n\n      .addon-container:hover {\n        ${this.stylesToCSS(t.styles.addonContainerHover)}\n      }\n\n      .addon-container.selected {\n        ${this.stylesToCSS(t.styles.addonContainerSelected)}\n      }\n\n      .addon-label {\n        display: flex;\n        align-items: flex-start;\n        cursor: pointer;\n        margin: 0;\n        width: 100%;\n      }\n\n      .addon-checkbox {\n        margin: 0;\n        margin-right: 10px;\n        margin-top: 2px;\n        accent-color: ${this.config.primaryColor};\n      }\n\n      .addon-checkmark {\n        /* Custom checkbox styling can be added here */\n      }\n\n      .addon-content {\n        flex: 1;\n        min-width: 0;\n      }\n\n      .addon-main {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 4px;\n        gap: 8px;\n      }\n\n      .addon-title {\n        font-weight: 500;\n        color: ${this.config.textColor};\n        font-size: ${this.getFontSize("title")};\n        line-height: 1.3;\n        flex: 1;\n      }\n\n      .addon-price {\n        font-weight: 600;\n        color: ${this.config.primaryColor};\n        font-size: ${this.getFontSize("price")};\n        white-space: nowrap;\n      }\n\n      .addon-description {\n        color: #666;\n        font-size: ${this.getFontSize("description")};\n        line-height: 1.4;\n        margin-top: 4px;\n      }\n\n      .addon-image {\n        margin-top: 8px;\n      }\n\n      .addon-image img {\n        max-width: ${this.getImageSize()};\n        max-height: 40px;\n        border-radius: ${this.getImageBorderRadius()};\n        object-fit: cover;\n      }\n\n      /* Loading state */\n      .addon-container.loading {\n        opacity: 0.6;\n        pointer-events: none;\n      }\n\n      .addon-container.loading::after {\n        content: '';\n        position: absolute;\n        top: 50%;\n        right: 12px;\n        width: 16px;\n        height: 16px;\n        border: 2px solid ${this.config.primaryColor};\n        border-top: 2px solid transparent;\n        border-radius: 50%;\n        animation: spin 1s linear infinite;\n      }\n\n      /* Error state */\n      .addon-container.error {\n        border-color: #dc3545;\n        background-color: #fff5f5;\n      }\n\n      /* Disabled state */\n      .addon-container.disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n\n      .addon-container.disabled .addon-checkbox {\n        pointer-events: none;\n      }\n\n      /* Animations */\n      .addon-price-highlight {\n        animation: priceHighlight 0.6s ease;\n      }\n\n      @keyframes priceHighlight {\n        0%, 100% { background-color: transparent; }\n        50% { background-color: ${this.config.primaryColor}20; }\n      }\n\n      @keyframes spin {\n        0% { transform: translate(-50%, -50%) rotate(0deg); }\n        100% { transform: translate(-50%, -50%) rotate(360deg); }\n      }\n\n      /* Responsive design */\n      @media (max-width: 480px) {\n        .shoplazza-addon-container {\n          margin: 10px 0;\n        }\n\n        .addon-container {\n          padding: 10px;\n        }\n\n        .addon-main {\n          flex-direction: column;\n          align-items: flex-start;\n          gap: 4px;\n        }\n\n        .addon-title {\n          font-size: 13px;\n        }\n\n        .addon-price {\n          font-size: 13px;\n        }\n\n        .addon-description {\n          font-size: 11px;\n        }\n      }\n\n      /* Accessibility */\n      .addon-container:focus-within {\n        outline: 2px solid ${this.config.primaryColor};\n        outline-offset: 2px;\n      }\n\n      .addon-checkbox:focus {\n        outline: none;\n      }\n\n      /* High contrast mode support */\n      @media (prefers-contrast: high) {\n        .addon-container {\n          border-width: 2px;\n        }\n\n        .addon-title {\n          font-weight: 600;\n        }\n\n        .addon-price {\n          font-weight: 700;\n        }\n      }\n\n      /* Reduced motion support */\n      @media (prefers-reduced-motion: reduce) {\n        .addon-container,\n        .addon-container:hover,\n        .addon-container.selected {\n          transition: none;\n        }\n\n        .addon-price-highlight {\n          animation: none;\n        }\n      }\n\n      /* Dark mode support */\n      @media (prefers-color-scheme: dark) {\n        .addon-container {\n          background: #1a1a1a;\n          border-color: #404040;\n          color: #ffffff;\n        }\n\n        .addon-title {\n          color: #ffffff;\n        }\n\n        .addon-description {\n          color: #cccccc;\n        }\n\n        .addon-container.selected {\n          background-color: ${this.config.primaryColor}20;\n        }\n      }\n\n      /* Custom CSS */\n      ${this.config.customCss}\n    `}stylesToCSS(t){return Object.entries(t).map(([t,e])=>`${this.camelToKebab(t)}: ${e};`).join("\n        ")}camelToKebab(t){return t.replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g,"$1-$2").toLowerCase()}getFontSize(t){const e={compact:{title:"13px",price:"13px",description:"11px"},default:{title:"14px",price:"14px",description:"12px"}};return e["compact"===this.config.theme?"compact":"default"][t]||e.default[t]}getImageSize(){return"compact"===this.config.theme?"50px":"60px"}getImageBorderRadius(){const t={rounded:"8px",minimal:"2px",compact:"3px",default:"4px"};return t[this.config.theme]||t.default}updateConfig(t){this.config={...this.config,...t},this.themes=this.initializeThemes(),this.applyTheme(),this.log("Theme configuration updated")}switchTheme(t){this.themes[t]?(this.config.theme=t,this.applyTheme(),this.log(`Switched to theme: ${t}`)):this.log(`Theme not found: ${t}`,"warn")}getAvailableThemes(){return Object.keys(this.themes).map(t=>({key:t,name:this.themes[t].name}))}addCustomTheme(t,e){this.themes[t]={name:t.charAt(0).toUpperCase()+t.slice(1),styles:e},this.log(`Added custom theme: ${t}`)}removeStyles(){this.styleElement&&(this.styleElement.remove(),this.styleElement=null,this.log("Theme styles removed"))}getCurrentTheme(){return{name:this.config.theme,config:{...this.config},theme:this.themes[this.config.theme]}}generatePreviewCSS(t,e={}){const n={...this.config};this.config={...this.config,...e,theme:t};const o=this.generateCSS();return this.config=n,o}log(t,e="info"){if(!this.config.debug)return;const n="[Theme Manager]";switch(e){case"error":console.error(n,t);break;case"warn":console.warn(n,t);break;default:console.log(n,t)}}};const o=new class{constructor(t={}){this.instances=new Map,this.defaultConfig={debug:!1,autoInit:!0,autoDetectProduct:!0,...t}}init(e={}){const n={...this.defaultConfig,...e};try{const e=new t(n),o=this.generateInstanceId();return this.instances.set(o,e),n.debug&&console.log("[Shoplazza Add-On Widget] Initialized with config:",n),{id:o,widget:e,destroy:()=>this.destroy(o),getState:()=>e.getState(),updateConfig:t=>e.updateConfig(t)}}catch(t){throw console.error("[Shoplazza Add-On Widget] Initialization failed:",t),t}}initForProduct(t,e={}){return this.init({...e,productId:t,autoDetectProduct:!1})}initMultiple(t){return t.map(t=>this.init(t))}destroy(t){const e=this.instances.get(t);return!!e&&(e.destroy(),this.instances.delete(t),!0)}destroyAll(){this.instances.forEach((t,e)=>{t.destroy()}),this.instances.clear()}getInstance(t){return this.instances.get(t)}getAllInstances(){return Array.from(this.instances.values())}setDefaultConfig(t){this.defaultConfig={...this.defaultConfig,...t}}createCartService(t={}){return new e({...this.defaultConfig,...t})}createThemeManager(t={}){return new n({...this.defaultConfig,...t})}async hasAddOns(t,e){try{const n=await fetch(`/api/products/${e}?shop=${encodeURIComponent(t)}`);return n.ok&&(await n.json()).isEnabled||!1}catch(t){return console.warn("[Shoplazza Add-On Widget] Failed to check add-ons:",t),!1}}autoInit(){const t={...this.getMetaConfig(),...window.ShoplazzaAddonConfig||{}};!1!==t.autoInit&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{this.init(t)}):this.init(t))}getMetaConfig(){const t={};return Object.entries({"shoplazza-addon-shop":"shop","shoplazza-addon-product-id":"productId","shoplazza-addon-api-endpoint":"apiEndpoint","shoplazza-addon-theme":"theme","shoplazza-addon-debug":"debug"}).forEach(([e,n])=>{const o=document.querySelector(`meta[name="${e}"]`);if(o){let e=o.getAttribute("content");"true"===e&&(e=!0),"false"===e&&(e=!1),"productId"===n&&e&&(e=parseInt(e,10)),t[n]=e}}),t}generateInstanceId(){return`shoplazza-addon-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}getVersion(){return"1.0.0"}getDebugInfo(){return{version:this.getVersion(),instances:this.instances.size,defaultConfig:this.defaultConfig,userAgent:navigator.userAgent,url:window.location.href,timestamp:(new Date).toISOString()}}};o.autoInit(),window.ShoplazzaAddon=o,window.ShoplazzaAddon.WidgetCore=t,window.ShoplazzaAddon.CartService=e,window.ShoplazzaAddon.ThemeManager=n}();