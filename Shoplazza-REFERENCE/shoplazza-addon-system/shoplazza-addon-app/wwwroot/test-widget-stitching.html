<!DOCTYPE html>
<html>
<head>
    <title>Test Widget Stitching - Mimics Shoplazza</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .product-info { border: 1px solid #ccc; padding: 20px; margin: 20px 0; }
        .test-section { background: #f5f5f5; padding: 15px; margin: 15px 0; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>üß™ Test Widget Stitching - Mimics Shoplazza</h1>
    
    <div class="test-section">
        <h3>Test Setup:</h3>
        <p>This page simulates how Shoplazza would load our widget script.</p>
        <p>Expected flow: Script loads ‚Üí HTML/CSS injected ‚Üí Widget renders ‚Üí Fetch interception works</p>
    </div>
    
    <div class="product-info">
        <h2>Product: Test Product</h2>
        <p>Price: $100.00</p>
        <p>SKU: TEST-001</p>
        <p>Description: This is a test product to verify widget functionality</p>
        
        <!-- This is where our widget should be injected -->
        <div id="widget-injection-point">
            <p><em>Widget should appear here...</em></p>
        </div>
    </div>
    
    <div class="test-section">
        <h3>Test Controls:</h3>
        <button onclick="testCartAPI()">üß™ Test Cart API Call</button>
        <button onclick="checkWidgetStatus()">üîç Check Widget Status</button>
        <button onclick="clearConsole()">üßπ Clear Console</button>
    </div>
    
    <div class="test-section">
        <h3>Test Results:</h3>
        <div id="test-results"></div>
    </div>
    
    <div class="test-section">
        <h3>Console Output:</h3>
        <div id="console-output" style="background: #000; color: #0f0; padding: 10px; font-family: monospace; height: 200px; overflow-y: scroll;"></div>
    </div>
    
    <script>
        // Mock console.log to capture output
        const originalConsoleLog = console.log;
        const originalConsoleWarn = console.warn;
        const originalConsoleError = console.error;
        
        function captureConsole(type, ...args) {
            const output = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const message = `[${timestamp}] ${type.toUpperCase()}: ${args.join(' ')}`;
            output.innerHTML += message + '<br>';
            output.scrollTop = output.scrollHeight;
            
            // Also call original console methods
            if (type === 'log') originalConsoleLog.apply(console, args);
            if (type === 'warn') originalConsoleWarn.apply(console, args);
            if (type === 'error') originalConsoleError.apply(console, args);
        }
        
        console.log = (...args) => captureConsole('log', ...args);
        console.warn = (...args) => captureConsole('warn', ...args);
        console.error = (...args) => captureConsole('error', ...args);
        
        // Test functions
        function testCartAPI() {
            console.log('üß™ Testing cart API call...');
            
            // Simulate what Shoplazza would do
            fetch('/api/cart', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    id: 'test-product-id',
                    quantity: 1
                })
            }).then(response => {
                console.log('‚úÖ Cart API call completed');
                document.getElementById('test-results').innerHTML = '<p class="success">‚úÖ Cart API call intercepted and modified successfully!</p>';
            }).catch(error => {
                console.log('‚úÖ Cart API call intercepted (expected to fail locally)');
                document.getElementById('test-results').innerHTML = '<p class="success">‚úÖ Cart API call intercepted successfully!</p>';
            });
        }
        
        function checkWidgetStatus() {
            const widget = window.ShoplazzaAddonWidget;
            if (widget) {
                console.log('üîç Widget status:', {
                    initialized: widget.initialized,
                    currentProductId: widget.currentProductId,
                    addOnConfig: widget.addOnConfig
                });
                document.getElementById('test-results').innerHTML = '<p class="success">‚úÖ Widget found and initialized!</p>';
            } else {
                console.log('‚ùå Widget not found');
                document.getElementById('test-results').innerHTML = '<p class="error">‚ùå Widget not found!</p>';
            }
        }
        
        function clearConsole() {
            document.getElementById('console-output').innerHTML = '';
            document.getElementById('test-results').innerHTML = '';
        }
        
        // Auto-test on load
        window.addEventListener('load', function() {
            console.log('üöÄ Page loaded, waiting for widget script...');
            
            // Wait a bit for widget to initialize
            setTimeout(() => {
                console.log('‚è∞ Checking widget initialization...');
                checkWidgetStatus();
            }, 2000);
        });
    </script>
    
    <!-- This simulates how Shoplazza would load our widget -->
    <script src="http://localhost:5128/api/widget/widget.js?shop=test-shop"></script>
</body>
</html>
