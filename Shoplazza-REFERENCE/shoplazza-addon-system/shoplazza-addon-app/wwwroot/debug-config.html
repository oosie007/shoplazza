<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Config Template</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Debug Config Template Processing</h1>
    
    <div class="debug-section">
        <h2>Template Variables Test</h2>
        <p><strong>SHOP_DOMAIN:</strong> <span id="shopDomain">{{SHOP_DOMAIN}}</span></p>
        <p><strong>ADDON_LIST_HTML:</strong> <span id="addonList">{{ADDON_LIST_HTML}}</span></p>
    </div>
    
    <div class="debug-section">
        <h2>Element Existence Test</h2>
        <p><strong>productSelect element:</strong> <span id="productSelectExists">Checking...</span></p>
        <p><strong>productId element:</strong> <span id="productIdExists">Checking...</span></p>
        <p><strong>variantSelect element:</strong> <span id="variantSelectExists">Checking...</span></p>
    </div>
    
    <div class="debug-section">
        <h2>Form Elements</h2>
        <form id="addonForm">
            <div>
                <label for="productSelect">Product</label>
                <select id="productSelect" name="productId" required>
                    <option value="" disabled selected>Select a product...</option>
                </select>
                <input type="hidden" id="productId" name="productId">
            </div>
            <div>
                <label for="variantSelect">Variant</label>
                <select id="variantSelect">
                    <option value="" disabled selected>Select a variant...</option>
                </select>
            </div>
        </form>
    </div>
    
    <div class="debug-section">
        <h2>JavaScript Test Results</h2>
        <div id="jsResults"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('jsResults');
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(div);
        }

        function checkElements() {
            log('Checking element existence...');
            
            // Check if elements exist
            const productSelect = document.getElementById('productSelect');
            const productId = document.getElementById('productId');
            const variantSelect = document.getElementById('variantSelect');
            
            document.getElementById('productSelectExists').textContent = 
                productSelect ? '✅ EXISTS' : '❌ NOT FOUND';
            document.getElementById('productIdExists').textContent = 
                productId ? '✅ EXISTS' : '❌ NOT FOUND';
            document.getElementById('variantSelectExists').textContent = 
                variantSelect ? '✅ EXISTS' : '❌ NOT FOUND';
            
            if (productSelect) {
                log('✅ productSelect element found', 'success');
            } else {
                log('❌ productSelect element NOT found', 'error');
            }
            
            if (productId) {
                log('✅ productId element found', 'success');
            } else {
                log('❌ productId element NOT found', 'error');
            }
            
            if (variantSelect) {
                log('✅ variantSelect element found', 'success');
            } else {
                log('❌ variantSelect element NOT found', 'error');
            }
        }

        function testLoadProducts() {
            log('Testing loadProducts function...');
            
            try {
                const select = document.getElementById('productSelect');
                if (!select) {
                    log('❌ productSelect is null - cannot populate', 'error');
                    return;
                }
                
                // Simulate populating the select
                const testProducts = [
                    { id: '123', title: 'Test Product 1' },
                    { id: '456', title: 'Test Product 2' }
                ];
                
                testProducts.forEach(p => {
                    const opt = document.createElement('option');
                    opt.value = p.id;
                    opt.textContent = `#${p.id} · ${p.title}`;
                    select.appendChild(opt);
                });
                
                log(`✅ Successfully added ${testProducts.length} test products`, 'success');
                
            } catch (error) {
                log(`❌ Error in testLoadProducts: ${error.message}`, 'error');
            }
        }

        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', function() {
            log('DOM Content Loaded - running tests...');
            checkElements();
            testLoadProducts();
        });

        // Also run tests after a short delay to ensure everything is ready
        setTimeout(() => {
            log('Delayed test run...');
            checkElements();
            testLoadProducts();
        }, 1000);
    </script>
</body>
</html>
