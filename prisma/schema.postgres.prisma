// Production: Postgres (Vercel, Prisma Postgres, etc.). Use with DATABASE_URL or PRISMA_DATABASE_URL.
// Local: keep using schema.prisma (SQLite) unless you set DATABASE_URL to a Postgres URL.

generator client {
  provider      = "prisma-client"
  output        = "../src/generated/prisma"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Store {
  id          String        @id @default(cuid())
  shopDomain  String        @unique
  accessToken String
  installedAt DateTime      @default(now())
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  settings    StoreSettings?
}

model StoreSettings {
  id                    String   @id @default(cuid())
  storeId               String   @unique
  activated             Boolean  @default(false)
  revenueShareTier      String   @default("5")
  protectionPercent     Int      @default(5)
  pricingMode           String   @default("fixed_percent_all")
  fixedPercentAll       Int      @default(5)
  categoryPercents      String   @default("{}")
  excludedCategoryIds   String   @default("[]")
  widgetVariant         String   @default("B")
  defaultAtCheckout     Boolean  @default(false)
  checkoutPlacement     String   @default("regular")
  enablePoweredByChubb  Boolean  @default(true)
  offerAtCheckout       Boolean  @default(true)
  claimPortalConfigured Boolean  @default(false)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  store Store @relation(fields: [storeId], references: [id], onDelete: Cascade)
}
